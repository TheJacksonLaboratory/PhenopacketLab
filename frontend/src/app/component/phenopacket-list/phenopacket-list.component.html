<div class="phenopacket-list">
  <div class="flex p-3 pl-0 card-btn-wrapper">
    <!-- <button mat-raised-button routerLink="/pheno-creator" class="add-tab-button">Add new individual</button> -->
    <p-fileUpload #fubauto mode="basic" name="file[]" [customUpload]="true"
                  (uploadHandler)="handleFileUpload($event)" [auto]="true" chooseLabel="Upload"
                  chooseIcon="pi-file-import" accept=".json">
    </p-fileUpload>
    <button pButton class="p-button-outlined ml-1" label="Create" icon="pi pi-plus" routerLink="/profile-selection"></button>
  </div>
  <p-tabView id="closableTabView" [(activeIndex)]="activeIndex" (onClose)="closeTab($event.index)" styleClass="phenopacket-list-tabs">
    <p-tabPanel header="Phenopackets" [selected]="true" class="first-panel">
      <p-table [value]="phenopackets" selectionMode="single" (onRowSelect)="openTab($event.data)">
        <ng-template pTemplate="header">
          <tr>
            <th>Identifier</th>
            <th>Last Encounter</th>
            <th>Sex</th>
            <th style="width: 8rem"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-phenopacket>
          <tr [pSelectableRow]="phenopacket">
            <td>{{phenopacket.id}}</td>
            <td>{{phenopacket.subject?.timeAtLastEncounter != null ? phenopacket.subject?.timeAtLastEncounter : '-'}}</td>
            <td>
              {{phenopacket.subject?.sex != null ? phenopacket.subject.sex : '-'}}
            </td>
            <td style="text-align: center">
              <button pButton type="button" class="p-button-danger" icon="pi pi-trash" (click)="removeIndividual(phenopacket)"></button>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage" let-columns>
          <tr>
            <td [attr.colspan]="4">
              No phenopackets found.
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-tabPanel>
    <p-tabPanel
            *ngFor="let phenopacket of individualTabs; let index = index"
            [header]="phenopacket.id"
            [closable]="true"
    >
      <div class="grid p-fluid">
        <div class="field col-12">
          <app-phenopacket
                  [phenopacket]="phenopacket"
                  (onIdChanged)="changeId($event, activeIndex)"
                  (onSexChanged)="changeSex($event, activeIndex)"
                  (onDobChanged)="changeDob($event, activeIndex)"
          >
          </app-phenopacket>
        </div>
      </div>
    </p-tabPanel>

  </p-tabView>
  <p-confirmDialog #cd [style]="{width: '50vw'}" key="positionDialog" position="bottom-right" [baseZIndex]="10000" rejectButtonStyleClass="p-button-outlined">
    <ng-template pTemplate="footer">
      <button type="button" pButton icon="pi pi-check" label="Yes" (click)="cd.accept()"></button>
      <button type="button" class="p-button-outlined" pButton icon="pi pi-times" label="No" (click)="cd.reject()"></button>
    </ng-template>
  </p-confirmDialog>
</div>

<p-card header="Phenopackets">
  <div>
    <a routerLink="/profile-selection"
      ><button mat-raised-button class="add-tab-button">
        Create new phenopacket
      </button></a
    >
    <!-- <button mat-raised-button routerLink="/pheno-creator" class="add-tab-button">Add new individual</button> -->
    <button
      mat-raised-button
      type="submit"
      matTooltip="Upload one or more phenopacket files in JSON or Yaml format"
      [matTooltipShowDelay]="2000"
      (click)="openFileUploadDialog()"
    >
      <mat-icon matSuffix>cloud_upload</mat-icon>
      Upload Phenopacket File
    </button>
  </div>
  
  <p-tabView id="closableTabView" [(activeIndex)]="activeIndex">
    <p-tabPanel header="Phenopacket list" [selected]="true">
        <!-- Table summary of individuals -->
        <table
          #varTable
          mat-table
          class="table-hover mat-elevation-z2"
          [dataSource]="datasource"
          matSort
          multiTemplateDataRows
        >
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>Id</th>
            <td mat-cell *matCellDef="let element">{{ element.id }}</td>
          </ng-container>
  
          <ng-container matColumnDef="timeOfLastEncounter">
            <th mat-header-cell *matHeaderCellDef>Time of last encounter</th>
            <td mat-cell *matCellDef="let element">{{ element.subject?.timeAtLastEncounter }}</td>
          </ng-container>
  
          <ng-container matColumnDef="sex">
            <th mat-header-cell *matHeaderCellDef>Sex</th>
            <td mat-cell *matCellDef="let element">
              {{ element.subject?.sex }}
            </td>
          </ng-container>
  
          <ng-container matColumnDef="download">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
              <button
                (click)="$event.stopPropagation()"
                mat-icon-button
                type="submit"
                class="pull-right"
                matTooltip="Download as JSON file"
                [matTooltipShowDelay]="2000"
                (click)="downloadPhenopacket(element)"
              >
                <mat-icon matSuffix>download</mat-icon>
              </button>
            </td>
          </ng-container>
          <ng-container matColumnDef="remove">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let element">
              <button
                (click)="$event.stopPropagation()"
                mat-icon-button
                type="submit"
                class="pull-right"
                matTooltip="Remove individual"
                [matTooltipShowDelay]="2000"
                (click)="removeIndividual(element)"
              >
                <mat-icon matSuffix>delete</mat-icon>
              </button>
            </td>
          </ng-container>
  
          <tr
            mat-row
            (click)="openTab(element)"
            *matRowDef="let element; columns: displayedColumns"
            class="example-element-row"
            matTooltip="Click to open in new tab"
            [matTooltipShowDelay]="2000"
          ></tr>
  
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns; sticky: true"
          ></tr>
        </table>
    </p-tabPanel>
    <p-tabPanel
      *ngFor="let phenopacket of individualTabs; let index = index"
      [header]="phenopacket.id"
      [closable]="true"
    >
      <div class="grid p-fluid">
        <div class="field col-12">
          <app-phenopacket
            [phenopacket]="phenopacket"
            (onIdChanged)="changeId($event, activeIndex)"
            (onSexChanged)="changeSex($event, activeIndex)"
            (onDobChanged)="changeDob($event, activeIndex)"
          >
          </app-phenopacket>
        </div>
      </div>
    </p-tabPanel>
  
  </p-tabView>
  
</p-card>

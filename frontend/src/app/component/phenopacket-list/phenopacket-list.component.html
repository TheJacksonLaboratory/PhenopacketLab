<p-card header="Phenopackets">
  
  <div>
    <a routerLink="/pheno-creator"
      ><button mat-raised-button class="add-tab-button">
        Add new individual
      </button></a
    >
    <!-- <button mat-raised-button routerLink="/pheno-creator" class="add-tab-button">Add new individual</button> -->
    <button
      mat-raised-button
      type="submit"
      matTooltip="Upload one or more phenopacket files in JSON or Yaml format"
      [matTooltipShowDelay]="2000"
      (click)="openFileUploadDialog()"
    >
      <mat-icon matSuffix>cloud_upload</mat-icon>
      Upload Phenopacket File
    </button>
  </div>
  
  <mat-tab-group
    [selectedIndex]="selected.value"
    (selectedIndexChange)="selected.setValue($event)"
  >
    <mat-tab label="Summary">
      <div class="row">
        <div class="col-md-12">
          <!-- Table summary of individuals -->
          <table
            mat-table
            #varTable
            class="table-hover mat-elevation-z2"
            [dataSource]="datasource"
            matSort
            multiTemplateDataRows
          >
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>Id</th>
              <td mat-cell *matCellDef="let element">{{ element.id }}</td>
            </ng-container>
  
            <ng-container matColumnDef="dob">
              <th mat-header-cell *matHeaderCellDef>Date of birth</th>
              <td mat-cell *matCellDef="let element">
                {{ formatDate(element.subject?.dateOfBirth, "MM-dd-yyyy") }}
              </td>
            </ng-container>
  
            <ng-container matColumnDef="sex">
              <th mat-header-cell *matHeaderCellDef>Sex</th>
              <td mat-cell *matCellDef="let element">
                {{ element.subject?.sex }}
              </td>
            </ng-container>
  
            <ng-container matColumnDef="remove">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let element">
                <button
                  (click)="$event.stopPropagation()"
                  mat-icon-button
                  type="submit"
                  class="pull-right"
                  matTooltip="Remove individual"
                  [matTooltipShowDelay]="2000"
                  (click)="removeIndividual(element)"
                >
                  <mat-icon matSuffix>delete</mat-icon>
                </button>
              </td>
            </ng-container>
  
            <tr
              mat-row
              (click)="openTab(element)"
              *matRowDef="let element; columns: displayedColumns"
              class="example-element-row"
              matTooltip="Click to open in new tab"
              [matTooltipShowDelay]="2000"
            ></tr>
  
            <tr
              mat-header-row
              *matHeaderRowDef="displayedColumns; sticky: true"
            ></tr>
          </table>
        </div>
      </div>
    </mat-tab>
    <mat-tab *ngFor="let phenopacket of individualTabs; let index = index">
      <ng-template mat-tab-label
        >{{ phenopacket.id
        }}<i
          class="material-icons close-icon"
          matTooltip="Close this tab"
          [matTooltipShowDelay]="2000"
          (click)="closeTab(index)"
          >close</i
        >
      </ng-template>
  
      <div layout="column" layout-align=" start">
         
          <div>
              <button
              (click)="closeTab(index)"
              mat-icon-button
              type="submit"
              class="pull-right delete-tab-button"
              matTooltip="Close this tab"
              [matTooltipShowDelay]="2000"
            >
              <mat-icon>close</mat-icon>
            </button>
          </div>
          
      </div>
      
      <app-phenopacket
        [phenopacket]="phenopacket"
        (onIdChanged)="changeId($event, index)"
        (onSexChanged)="changeSex($event, index)"
        (onDobChanged)="changeDob($event, index)"
      >
      </app-phenopacket>
    </mat-tab>
  </mat-tab-group>
  
</p-card>
